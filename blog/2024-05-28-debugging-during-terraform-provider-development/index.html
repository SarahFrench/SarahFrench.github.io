<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><style>@import 'https://fonts.googleapis.com/css2?family=VT323&display=swap'</style><link rel=stylesheet href=https://sarahfrench.dev/sass/main.css><base href=https://sarahfrench.dev/><script>document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#menu"),t=new IntersectionObserver((e)=>{console.log("callback fired");const n=e[0];n.target.classList.toggle("nav--pinned",n.intersectionRatio<1)},{threshold:[1]});t.observe(e)})</script><title>Debugging during Terraform provider development | Sarah French</title></head><body><nav id=menu class=nav><a class=nav-link href=/ title>Home
</a><a class=nav-link href=/blog title>Blog
</a><a class=nav-link href=/project title>Projects</a></nav><svg class="hero hero--subpage" width="100%" height="100%" viewBox="0 0 800 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5"><g transform="matrix(1,0,0,1,1,-196.312)"><g transform="matrix(1,0,0,0.506741,0,197.407)"><rect x="-.829" y="-2.161" width="801.197" height="402.37" style="fill:#12022d"/></g><g id="veticals"><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M393.82 194.416 393.843 399.466" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M416.82 194.418c17.341 68.353 52.023 205.057 52.023 205.057" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M439.82 194.421 546.843 399.484" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M462.82 194.424 623.844 399.493" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M485.82 194.426 699.727 400.248" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M507.82 194.429 773.844 399.51" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M532.82 194.432 793.839 362.588" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M550.82 194.434 793.835 326.59" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M573.82 194.436 793.832 300.223" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M597.82 194.439l196.01 83.156" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M618.82 194.442l175.008 65.906" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M640.82 194.444l153.006 51.093" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M661.82 194.447l132.005 39.408" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M681.82 194.449l112.004 30.77" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M703.82 194.451 793.823 217.017" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M722.82 194.454l71.002 15.393" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M740.821 194.456 793.821 202.96" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M757.821 194.458 793.821 197.538" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(0.999999,-0.000112464,-0.00011259,0.97537,6.20178,10.4171)"><path d="M773.821 194.46 793.821 194.462" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M416.82 194.418c17.341 68.353 52.023 205.057 52.023 205.057" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M439.82 194.421 546.843 399.484" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M462.82 194.424 623.844 399.493" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M485.82 194.426 699.727 400.248" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M507.82 194.429 773.844 399.51" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M532.82 194.432 793.839 362.588" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M550.82 194.434 793.835 326.59" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M573.82 194.436 793.832 300.223" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M597.82 194.439l196.01 83.156" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M618.82 194.442l175.008 65.906" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M640.82 194.444l153.006 51.093" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M661.82 194.447l132.005 39.408" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M681.82 194.449l112.004 30.77" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M703.82 194.451 793.823 217.017" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M722.82 194.454l71.002 15.393" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M740.821 194.456 793.821 202.96" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M757.821 194.458 793.821 197.538" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g><g transform="matrix(-0.999999,-0.000112464,0.00011259,0.97537,793.798,10.4171)"><path d="M773.821 194.46 793.821 194.462" style="fill:none;stroke:#ff00a6;stroke-width:2.03px"/></g></g><g id="horizontals"><path d="M0 365 8e2 365.024" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M0 328H8e2" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M8e2 302H0" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M0 280H8e2" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M8e2 263.6.0 263.843" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M0 249.563 8e2 249.576" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M0 237.737 8e2 237.846" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M0 230H8e2" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M-.092 222H8e2" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M0 215 8e2 214.978" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M.149 209H8e2" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><path d="M0 203H8e2" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/><g transform="matrix(1,0,0,1,0,-1)"><path d="M0 2e2H8e2.0z" style="fill:none;stroke:#8a8ac9;stroke-width:1px"/></g></g></g></svg><div class="main-wrapper main-wrapper--subpage"><main class=main-content><article class=blog-post><div class="tag-list__list styled-font"><a class=tag-list__item href=/tags/terraform>Terraform
</a><a class=tag-list__item href=/tags/how-to>How-To</a></div><header><h1 class="styled-font page-title">Debugging during Terraform provider development</h1></header><p class=blog__date>May 28, 2024</p><p>My first experience of &lsquo;debugging&rsquo; was using good old <code>console.log</code> in JavaScript code when I was first learning about programming. I&rsquo;d like to think I&rsquo;ve come a long way since then, but I was contributing to Terraform provider projects for an embrassingly long time before I introduced using a proper debugger into my work process. This blog is a way for me to share what I learned and hopefully help others (or just be a reference for myself in the future!).</p><h2 id=whats-a-terraform-provider>What&rsquo;s a Terraform provider?</h2><p>For breivity, this blog doesn&rsquo;t explain what Terraform and Terraform providers are at great length. There are much <a href=https://developer.hashicorp.com/terraform/language/providers>better resources out on the internet to explain them</a>. Having said that, here&rsquo;s a short summary: In a nutshell, Terraform is an Infrastructure as Code (IaC) tool that lets users write declarative configuration code that describes resources in the &lsquo;real world&rsquo; that they want to create. For example you might want to create an EC2 instance in AWS, or a new team in GitHub. When first provisioning and subsequently managing those resources Terraform interacts with third-party systems, such as AWS and GitHub, through Terraform providers. It&rsquo;s a bit of a simplification, but you can think of providers as an adapter between Terraform and third-party APIs. Terraform issues a command to providers to create a resource, and the provider handles what that creation process actually requires.</p><p>So, if Terraform providers are just simple adapters, what do you need to debug? Well&mldr;</p><h2 id=why-is-a-debugger-needed>Why is a debugger needed?</h2><p>In a perfect world, adding new functionality to a provider would be simple; it would only involve mapping data in the API to data in the Terraform representation of the resource. However APIs often have quirks that make it necessary to transform or manage data in a more complex way. For example, sometimes a resources cannot be managed in a purely declarative way through the API and there are imperative API endpoints that toggle a resource&rsquo;s state. To allow Terraform to manage the resource declarativly, the provider may need to interact with multiple API endpoints during a single create or update action. A simple example of this is <a href=https://github.com/GoogleCloudPlatform/magic-modules/pull/6304/files>toggling whether a <code>google_cloud_scheduler_job</code> resource is paused or not</a>. Using a debugger can help speed up adding new features (and exploring nasty bugs, too) when the provider needs to &lsquo;paper over cracks&rsquo; with more code.</p><h2 id=first-steps-debugging-during-acceptance-tests>First steps: Debugging during acceptance tests.</h2><p>The best approach when adding a new feature to a Terraform provider is to create an acceptance test that tests the new feature you&rsquo;re adding, or asserts that in a given scenario a bug <em>no longer happens</em>. You then work to make the test pass.</p><p>If you wanted to check how the provider code is used during a given test you can run a specific test in debug mode.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;version&#34;</span> : <span style=color:#f1fa8c>&#34;0.2.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;configurations&#34;</span> : [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#6272a4>// Debug acceptance tests
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>            <span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;Debug Selected Acceptance Test&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;request&#34;</span> : <span style=color:#f1fa8c>&#34;launch&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;type&#34;</span> : <span style=color:#f1fa8c>&#34;go&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;args&#34;</span> : [
</span></span><span style=display:flex><span>                <span style=color:#f1fa8c>&#34;-test.v&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f1fa8c>&#34;-test.run&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f1fa8c>&#34;^${}$&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;mode&#34;</span> : <span style=color:#f1fa8c>&#34;auto&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;program&#34;</span> : <span style=color:#f1fa8c>&#34;${fileDirname}&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;envFile&#34;</span> : <span style=color:#f1fa8c>&#34;${workspaceFolder}/.vscode/private.env&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;showLog&#34;</span> : <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=next-level-running-providers-in-debug-mode-for-manual-tests>Next level: Running providers in debug mode for manual tests.</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;version&#34;</span> : <span style=color:#f1fa8c>&#34;0.2.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;configurations&#34;</span> : [
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// Run provider in debug mode
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#f1fa8c>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;Start Provider in Debug Mode&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;request&#34;</span> : <span style=color:#f1fa8c>&#34;launch&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;type&#34;</span> : <span style=color:#f1fa8c>&#34;go&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;mode&#34;</span> : <span style=color:#f1fa8c>&#34;debug&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;args&#34;</span> : [
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;-debug&#34;</span>
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;program&#34;</span> : <span style=color:#f1fa8c>&#34;${workspaceFolder}&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;envFile&#34;</span> : <span style=color:#f1fa8c>&#34;${workspaceFolder}/.vscode/private.env&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;showLog&#34;</span> : <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></article></main></div><footer class=footer><p class=footer__text>© 2022, Built with <a class=underline href=https://gohugo.io/ rel="noopener noreferrer nofollow" target=_blank>Hugo</a></p></footer></body></html>